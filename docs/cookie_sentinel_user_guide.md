# Cookie 卫士 - 用户使用指南

## 什么是 Cookie 卫士？

Cookie 卫士是 FluentYTDL 的智能 Cookie 管理系统，它能：

- 🚀 **自动维护登录状态** - 应用启动时自动更新，无需手动操作
- 🔒 **智能检测问题** - 下载失败时自动识别是否为登录过期
- 🛠️ **一键修复** - 点击按钮即可重新验证，无需重启应用

---

## 快速开始

### 1. 首次配置

打开 FluentYTDL → 进入 **设置** → 找到 **身份验证** 选项卡

选择你的浏览器：
- **Edge** (推荐，兼容性最好)
- **Firefox**
- **Brave**
- ~~Chrome~~ (v130+ 需要管理员权限，不推荐)

**或者**手动导入 Cookie 文件：
- 点击"浏览..."选择你的 `cookies.txt` 文件

> 💡 **提示**：如果不确定选哪个，推荐使用 Edge 浏览器

### 2. 正常使用

配置完成后：
- ✅ 应用启动时会**自动**在后台更新 Cookie（你不会感觉到任何卡顿）
- ✅ 下载视频时直接使用已保存的 Cookie（速度极快）
- ✅ 登录状态可维持数周甚至数月

### 3. 遇到登录过期怎么办？

如果下载时看到这样的对话框：

```
┌─────────────────────────────────────┐
│  🔒 检测到 Cookie 验证失败           │
│                                      │
│  YouTube 需要重新验证身份            │
│                                      │
│  [ 稍后处理 ] [ 手动导入 ] [ 自动修复 ] │
└─────────────────────────────────────┘
```

**选择"自动修复"**：
1. 点击按钮
2. 如果弹出 UAC 提示（"是否允许此应用更改设备"），点击**是**
3. 等待 2-3 秒
4. 看到 ✅ 成功提示后，下载会自动继续

**或选择"手动导入"**：
1. 使用浏览器扩展（如 [Get cookies.txt LOCALLY](https://chrome.google.com/webstore/detail/get-cookiestxt-locally/)）导出 Cookie
2. 保存为 `cookies.txt` 文件
3. 在设置中导入该文件

---

## 常见问题

### Q1: 为什么启动后没有任何提示？

**这是正常的！** Cookie 卫士在后台静默工作，不会打扰你。

如果想确认是否正常工作，可以：
- 打开设置 → 身份验证 → 查看"最后更新时间"

### Q2: 什么时候需要管理员权限？

只在以下情况需要：
- 使用 Chrome 浏览器（v130+）
- 点击"自动修复"按钮时

其他情况（启动、下载）**不需要**管理员权限。

### Q3: 我的 Cookie 会被上传到网上吗？

**绝对不会！** Cookie 始终保存在你的本地电脑：
- 路径：`FluentYTDL/bin/cookies.txt`
- 只有 yt-dlp 会读取这个文件
- 不会发送到任何服务器

### Q4: 多久需要重新登录一次？

取决于你的 YouTube 账户设置：
- **一般情况**：2-4 周
- **启用"保持登录"**：数月甚至更长
- **频繁更换 IP**：可能更短

Cookie 卫士会在失效时自动提醒你修复。

### Q5: Edge 和 Chrome 有什么区别？

| 浏览器 | 兼容性 | 是否需要管理员权限 |
|--------|--------|-------------------|
| Edge   | ✅ 极好 | ❌ 不需要 |
| Firefox| ✅ 良好 | ❌ 不需要 |
| Chrome | ⚠️ 需注意 | ✅ 需要（v130+） |

**推荐顺序**：Edge > Firefox > Brave > Chrome

---

## 高级技巧

### 手动刷新 Cookie

如果你觉得 Cookie 可能过期了，可以：
1. 打开设置 → 身份验证
2. 点击"刷新"按钮
3. 等待几秒钟

### 检查 Cookie 状态

在下载日志中查找：
```
✅ Cookie Sentinel: Edge 浏览器 (更新于 5分钟前, 42 个 YouTube Cookie)
```

如果看到 `⚠️` 警告符号，说明 Cookie 可能快过期了。

### 切换浏览器

随时可以在设置中更换浏览器：
1. 选择新的浏览器
2. 点击"应用"
3. 重启应用（或点击"刷新"）

---

## 故障排除

### 问题：点击"自动修复"后没反应

**可能原因**：
- rookiepy 未安装
- 浏览器未安装
- UAC 被拒绝

**解决方案**：
1. 尝试重启应用
2. 选择"手动导入"方式
3. 查看日志文件（`logs/` 目录）

### 问题：一直提示 Cookie 失效

**可能原因**：
- YouTube 检测到异常行为
- Cookie 文件损坏
- 浏览器清空了 Cookie

**解决方案**：
1. 在浏览器中重新登录 YouTube
2. 确保勾选"保持登录"
3. 使用"自动修复"重新提取

### 问题：Chrome 提取总是失败

**解决方案**：
- **推荐**：改用 Edge 浏览器（100% 兼容）
- **或者**：以管理员身份运行 FluentYTDL
- **或者**：使用手动导入方式

---

## 获取帮助

如果以上方法都无法解决问题：

1. **查看日志**：`FluentYTDL/logs/` 目录
2. **查找关键字**：`[CookieSentinel]` 或 `[AuthService]`
3. **提交 Issue**：附上日志内容（记得删除敏感信息）

---

**享受无缝的下载体验！** 🎉
